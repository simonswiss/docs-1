---
title: Keystatic & Astro
description: Add content to your Astro project using Keystatic as a CMS
type: cms
service: Keystatic
i18nReady: false
---
import FileTree from '~/components/FileTree.astro'
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import Aside from '~/components/Aside.astro'

[Keystatic](https://keystatic.com/) is an open source, headless content-management system that allows you to structure your content and sync it with GitHub.

:::tip
If you're starting a **new Astro + Keystatic project from scratch**, you can use the [Keystatic CLI](https://keystatic.com/docs/quick-start#keystatic-cli) to generate a new project in seconds:

```bash
npm create @keystatic@latest
```

Select the Astro template, and you'll be ready to go!
:::

## Prerequisites

This guide assumes you already have **an existing an Astro project**.¬† If you don‚Äôt, you can follow the instructions in our¬†[Installation guide](/en/install/auto/).

:::note
If you intend to sync Keystatic's data with GitHub, you will also need **a GitHub account with `write` permissions** on the repository for this project.
:::

## Installing dependencies

We're going to need to install a few packages to get Keystatic going.

Keystatic outputs Markdoc and has a dependency on React, so first we need to add Astro's first-party integrations for both:

```bash
npx astro add react markdoc
```

Let's also install two Keystatic packages:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  npm install @keystatic/core @keystatic/astro
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  pnpm install @keystatic/core @keystatic/astro
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  yarn add @keystatic/core @keystatic/astro
  ```
  </Fragment>
</PackageManagerTabs>

## Creating a Keystatic config file

Keystatic needs a config file. This is where you can connect a project with a specific GitHub repository and define a content schema.

Let's create a file called `keystatic.config.ts` in the root of the project:

```ts
// keystatic.config.ts
import { config, fields, collection } from '@keystatic/core';

export default config({
  storage: {
    kind: 'local',
  },
  collections: {
    posts: collection({
      label: 'Posts',
      slugField: 'title',
      path: 'src/content/posts/*',
      format: { contentField: 'content' },
      schema: {
        title: fields.slug({ name: { label: 'Title' } }),
        content: fields.document({
          label: 'Content',
          formatting: true,
          dividers: true,
          links: true,
          images: true,
        }),
      },
    }),
  },
});
```

We export a config object wrapped in the `config` function imported from `@keystatic/core`.

For now, we set the `storage` strategy to `local`, and we create a ‚Äúposts‚Äù `collection.`

:::note
The schema of your Keystatic collections should match the collections you've defined in Astro's [content collections](/en/guides/content-collections/#defining-collections).

We're working on a way to automatically sync Keystatic collections with Astro's content collections... Stay tuned! ü§ó
:::

This is all Keystatic needs to start managing content, configuration-wise.

Now, we need to display the Keystatic Admin UI on our site!

## Keystatic Admin UI pages

In our `pages` directory, we want every route within the `/keystatic` segment to become a Keystatic Admin UI route.

We can leverage Astro's [Rest parameters](/en/core-concepts/routing/#rest-parameters) to match file paths of any depth.

Let's create a new page called `src/pages/keystatic/[...params].astro`:

```ts
---
// src/pages/keystatic/[...params].astro

// TODO: Display Keystatic pages
---
```

The Keystatic Admin UI is built with React. So that we can import and mount this app here with React, let's create a new file outside of the pages directory.

I'll put it in the project root, alongside our Keystatic config file.

```ts
// keystatic.page.ts
import { makePage } from '@keystatic/astro/ui'
import keystaticConfig from './keystatic.config'

export const Keystatic = makePage(keystaticConfig)
```

Now, we can import that file in our `keystatic/[...params].astro` page, and mount the component on the clientside only:

```ts
---
// src/pages/keystatic/[...params].astro
import { Keystatic } from '../../../keystatic.page'
---

<Keystatic client:only />
```

Next, start up Astro's integrated server:

```
npm run dev
```

### Visiting the Keystatic Admin UI

At this point, if you try to visit the `/keystatic` route in the browser, you'll get an error:

<Aside title="error" type="danger">
  `getStaticPaths()` function is required for dynamic routes. Make sure that you export a `getStaticPaths` function from your dynamic route.
  
  Alternatively, set `output: "server"` in your Astro config file to switch to a non-static server build.
</Aside>

We *could* do this, but we'll use Astro's new `hybrid` rendering mode, which works even better for our needs.

### Astro's SSR hybrid mode

In the `astro.config.mjs`, add the `output: 'hybrid'` option:

```diff
export default defineConfig({
+ output: 'hybrid',
  integrations: [react()],
})
```

Hybrid rendering will still try to pre-render every page by default, with a mechanism to opt out of it.

We *don't want* prerendering on Keystatic routes. Let's export a `const prerender = false` in our Keystatic pages file:

```diff
---
// src/pages/keystatic/[...params].astro
import { Keystatic } from '../../../keystatic.page'

+ export const prerender = false
---

<Keystatic client:only />

```

Before we can read and write data, we also need to create some `API routes` for Keystatic

### Keystatic API Routes

Create a new file called `src/pages/api/keystatic/[...params].ts`

Once again, we use Astro's Rest parameters here.

```jsx
// src/pages/api/keystatic/[...params].ts
import { makeHandler } from '@keystatic/astro/api'
import keystaticConfig from '../../../../keystatic.config'

export const all = makeHandler({
  config: keystaticConfig,
})

export const prerender = false
```

Notice we also opt out of prerendering for those routes.

Aaaand... We should be all set to use Keystatic now üéâ

:::note
At this point, you should be able to visit the `/keystatic` route in the browser and see the Keystatic Admin UI. 
:::

## Creating a new post

Try and visit the `/keystatic` page in the browser one more time, and click on the ‚ÄúPosts‚Äù collection.

Go ahead, and create a new post!

:::note
In our Keystatic config file, we've set the `path` property for our `posts` collection to `src/content/posts/*`.

As a result, creating a new post from the Keystatic Admin UI should create a new `content` directory in the `src` directory, with the new post `.mdoc` file inside!
:::

If everything worked correctly, you'll find your new post inside the `src/content/posts` directory:

<FileTree title="Project Structure">
- src/
  - content/
    - posts/
      - **my-first-post.mdoc**
</FileTree>

That Markdoc file should look something like this:

```markdown
---
title: My First Post
---

This is my very first post. I am **super** excited.
```

Niiiice ‚ú®

Let's try to display that post on the frontend now.

## Rendering Keystatic content

:::tip
While Keystatic provides its own [Reader and Renderer APIs](https://keystatic.com/docs/reader-api) to pull data your frontend, it also work great with Astro's [content collections](/en/guides/content-collections/)!
:::

### Displaying a collection list

Since we told Keystatic to manage `posts` in `src/content/posts`, they'll be available as Astro's content collections as the `posts` collection slug:

```tsx
---
import { getCollection } from 'astro:content'

const posts = await getCollection('posts')
---

<main>
  <pre>{JSON.stringify(posts, null, 2)}</pre>
</main>

```

Pretty cool, eh?

### Displaying a single collection entry

You can also get a single collection entry by its slug:

```tsx
---
import { getEntry } from 'astro:content'

const post = await getEntry('posts', 'my-first-post')
---

<main>
  <pre>{JSON.stringify(post, null, 2)}</pre>
</main>
```

### Rendering document field content

If you look at the output from our `post` entry from above, you'll notice that the `body` field ‚Äì the `content` of our post ‚Äì is displaying raw Markdoc.

But you probably want to render HTML instead on your page.

Well, good news: Astro provides a `<Content />` component that can do the heavy lifting of converting rich text data into properly formatted markup:

```tsx
---
import { getEntry } from 'astro:content'

const post = await getEntry('posts', 'my-first-post')
const { Content } = await post.render()
---

<main>
  <h1>{post.data.title}</h1>
  <Content />
</main>

```

Sweet!

## Deploying Keystatic + Astro

Because Keystatic needs to run serverside code and use Node.js APIs, you'll need to add an [Astro adapter](/en/guides/server-side-rendering/#adding-an-adapter) to deploy your project.

You'll also probably want to [connect Keystatic to GitHub](https://keystatic.com/docs/connect-to-github) so you can manage content on the deployed instance of the project.

## Official Resources

- Check out [the official Keystatic guide](https://keystatic.com/docs/installation-astro)
- [Keystatic starter template](https://github.com/Thinkmill/keystatic/tree/main/templates/astro)